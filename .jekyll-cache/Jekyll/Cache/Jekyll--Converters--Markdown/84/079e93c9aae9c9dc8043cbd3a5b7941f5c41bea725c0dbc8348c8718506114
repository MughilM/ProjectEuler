I"ƒ%<h2 id="question">Question</h2>

<p>All square roots are periodic when written as continued fractions and can be written in the form:</p>

<p>[\sqrt{N}=a_0 + \frac{1}{a_1 + \frac{1}{a_2 + \frac{1}{a_3+\dots}}}]</p>

<p>For example, let us consider \(\sqrt{23}\):</p>

<p>[\sqrt{23}=4+\sqrt{23}-4=4 + \frac{1}{\frac{1}{\sqrt{23} - 4}} = 4 + \frac{1}{1 + \frac{\sqrt{23} - 3}{7}}]</p>

<p>If we continue we would get the following expansion:</p>

<p>[\sqrt{23} = 4 + \frac{1}{1 + \frac{1}{3 + \frac{1}{1 + \frac{1}{8 + \dots}}}}]</p>

<p>The process can be summarized as follows:</p>

<p>[\begin{aligned}
a_0 &amp;= 4, \frac{1}{\sqrt{23}-4} = \frac{\sqrt{23} + 4}{7} = 1 + \frac{\sqrt{23} - 3}{7}
<br />
a_1 &amp;= 1, \frac{7}{\sqrt{23}-3} = \frac{7(\sqrt{23} + 3)}{14} = 3 + \frac{\sqrt{23} - 3}{2}
<br />
a_2 &amp;= 3, \frac{1}{\sqrt{23}-4} = \frac{\sqrt{23} + 4}{7} = 1 + \frac{\sqrt{23} - 3}{7}
<br />
a_3 &amp;= 1, \frac{7}{\sqrt{23}-4} = \frac{7(\sqrt{23} + 4)}{7} = 8 + \sqrt{23} - 4
<br />
a_4 &amp;= 8, \frac{1}{\sqrt{23}-4} = \frac{\sqrt{23} + 4}{7} = 1 + \frac{\sqrt{23} - 3}{7}
<br />
a_5 &amp;= 1, \frac{7}{\sqrt{23}-3} = \frac{7(\sqrt{23} + 3)}{14} = 3 + \frac{\sqrt{23} - 3}{2}
<br />
a_6 &amp;= 3, \frac{1}{\sqrt{23}-4} = \frac{\sqrt{23} + 4}{7} = 1 + \frac{\sqrt{23} - 3}{7}
<br />
a_7 &amp;= 1, \frac{7}{\sqrt{23}-4} = \frac{7(\sqrt{23} + 4)}{7} = 8 + \sqrt{23} - 4
\end{aligned}]</p>

<p>It can be seen that the sequence is repeating. For conciseness, we use the notation \(\sqrt{23}=[4;(1,3,1,8)]\), to indicate that the block (1,3,1,8) repeats indefinitely.</p>

<p>The first ten continued fraction representation of (irrational) square roots are:</p>

<p>[\begin{aligned}
\sqrt{2} &amp;= [1;(2)], \text{period=1}
<br />
\sqrt{3} &amp;= [1:(1,2)], \text{period=2}
<br />
\sqrt{5} &amp;= [2;(4)], \text{period=1}
<br />
\sqrt{6} &amp;= [2;(2,4)], \text{period=2}
<br />
\sqrt{7} &amp;= [2;(1,1,1,4)], \text{period=4}
<br />
\sqrt{8} &amp;= [2;(1,4)], \text{period=2}
<br />
\sqrt{10} &amp;= [3;(6)], \text{period=1}
<br />
\sqrt{11} &amp;= [3;(3,6)], \text{period=2}
<br />
\sqrt{12} &amp;= [3;(2,6)], \text{period=2}
<br />
\sqrt{13} &amp;= [3;(1,1,1,1,6)], \text{period=5}
\end{aligned}]</p>

<p>Exactly four continued fractions, for \(N\leq 13\), have an odd period.</p>

<p>How many continued fractions for \(N\leq10\,000\) have an odd period?</p>

<h2 id="answer">Answer</h2>

<p>The crux of this problem lies in finding the period of the continued fraction of \(\sqrt{N}\). Whenever we are trying to find cycles, we need a bound to stop generating numbers. Otherwise, we could sit here indefinitely generating the next number in the sequence without knowing when to stop and look for a cycle.</p>

<p>After some research, I found this little tidbit in <a href="https://en.wikipedia.org/wiki/Periodic_continued_fraction#Reduced_surds">this Wikipedia article</a> that reads:</p>

<blockquote>
  <p>If \(r&gt;1\) is a rational number that is not a perfect square, then
\(\sqrt{r} = [a_0;\overline{a_1,a_2,\dots,a_2,a_1,2a_0}]\)</p>
</blockquote>

<p>The details of the proof are slightly out of scope for this site, but feel free to read the article if you are interested.</p>

<p>So this gives a way to calculate the length of the period. In these cases, \(a_0\) corresponds to the integer part of \(\sqrt{N}\). We keep generating the next number in the sequence until we reach \(2a_0\).</p>

<p>Now then, how do we keep calculate each number in the sequence? One simple way is to keep reciprocating and taking the integer part. For example:</p>

<ul>
  <li>
\[\sqrt{23}\approx 4.79 \Rightarrow a_0=4\]
  </li>
  <li>
\[\sqrt{23}-\mathbf{a_0}\approx 0.79 \Rightarrow \frac{1}{0.79}\approx 1.256 \Rightarrow a_1 = 1\]
  </li>
  <li>
\[\frac{1}{1.256-\mathbf{a_1}}\approx 3.90 \Rightarrow a_2 = 3\]
  </li>
  <li>
\[\frac{1}{3.90-\mathbf{a_2}}\approx 1.11 \Rightarrow a_3 = 1\]
  </li>
  <li>
\[\frac{1}{1.11-\mathbf{a_3}}\approx 8.79 \Rightarrow a_4=8\]
  </li>
</ul>

<p>Since \(a_4 = 8 = 2(4) = 2a_0\), we are done, and the length is 4. This is a perfectly reasonable way to calculate the sequence. However, in computer terms, it is pretty inefficient, because we have to constantly keep track of floating point numbers. An integer-only way to generate the sequence would be much preferred because it is much faster to do integer arithmetic.</p>

<p>Thankfully, I stumbled upon <a href="https://en.wikipedia.org/wiki/Methods_of_computing_square_roots#Algorithm">this section in a Wiki article</a> describing how to generate the sequence using only integers. I wonâ€™t reproduce it here for conciseness, but the algorithm essentially keeps track of the irrational radical fraction that you repeatedly see in the problem example \(\frac{\sqrt{23}-3}{7}, \frac{\sqrt{23}-3}{2}\), etc. It relies on the guaranteed fact that \(N-m_{n+1}^2\) always divides \(d_n\) at each step. The reason why is a bit out of scope for this answer, and I encourage you to read <a href="https://math.stackexchange.com/questions/213683/calculate-the-continued-fraction-of-square-root">this math StackExachange question</a> if you are curious.</p>

<p>Okay, so the algorithm is simple enough to directly convert into code, since it only uses integers. See the <code class="highlighter-rouge">periodLength</code> function below.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">periodLength</span><span class="p">(</span><span class="n">S</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">d</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c1"># Integer part is a0
</span>    <span class="n">a0</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S</span><span class="p">))</span>
    <span class="c1"># Current a
</span>    <span class="n">a</span> <span class="o">=</span> <span class="n">a0</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Keep going until we get to 2a_0
</span>    <span class="k">while</span> <span class="n">a</span> <span class="o">!=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a0</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="n">a</span> <span class="o">-</span> <span class="n">m</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span> <span class="o">-</span> <span class="n">m</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">//</span> <span class="n">d</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">a0</span> <span class="o">+</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="n">d</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">count</span>
</code></pre></div></div>

<p>Now, all we have to do is loop through each \(N\) (which arenâ€™t square numbers), and see whether the period length is odd. We do this by computing \(N\mod 2\). If itâ€™s 1, then \(N\) is odd.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">oddPeriod</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10001</span><span class="p">):</span>
    <span class="c1"># Skip square numbers
</span>    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="o">==</span> <span class="n">math</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">continue</span>
    <span class="c1"># Calculate period length and check if odd
</span>    <span class="n">length</span> <span class="o">=</span> <span class="n">periodLength</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">periodLength</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">oddPeriod</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="k">print</span><span class="p">(</span><span class="n">oddPeriod</span><span class="p">)</span>
</code></pre></div></div>

<p>Running this short loop gets us,</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1322
0.4687670246846322 seconds.
</code></pre></div></div>

<p>Therefore, there are <strong>1322</strong> numbers below 10,000 where the period length of the continued fraction of the square root is odd.</p>
:ET