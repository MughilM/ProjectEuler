I"®$<h2 id="question">Question</h2>

<p>The number 3797 has an interesting property. Being prime itself, it is possible to continuously remove digits from left to right, and remain prime at each stage: 3797, 797, 97, and 7. Similarly we can work from right to left: 3797, 379, 37, 3.</p>

<p>Find the sum of the only eleven primes that are both truncatable from left to right and right to left.</p>

<p>NOTE: 2, 3, 5, and 7 are not considered to be truncatable primes.</p>

<h2 id="answer">Answer</h2>

<p>For terminology, Iâ€™ll call a prime where you can chop off digits from left to right a <strong>left truncatable prime</strong>. Similarly, being able to chop off digits right to left will be called a <strong>right truncatable prime</strong>.</p>

<p>One way to do this is to generate primes which satisfy one of the two properties, and then check to see whether it satisfies the other property. Left truncatable primes are easier to generate, while right truncatable primes are simpler to check for validity.</p>

<p>Now, when you chop off digits left to right, the single digit you will end up at is the ones digit in the original number. This <strong>must</strong> be prime, otherwise the prime will never be left truncatable. The one-digit prime numbers are 2, 3, 5, and 7. However, any number ending in 2 (other than 2 itself), isnâ€™t prime. Therefore, all <strong>left truncatable primes will end in 3, 5, or 7</strong>.</p>

<p>We can do a similar analysis for right-truncatable primes. Chopping digits from right to left will mean the final digit you check will be the digit all the way on the left. This number is only allowed to be 2, 3, 5, or 7 because those are our one-digit primes. However, because we are adding digits to the left of numbers each time, we have to watch out for numbers which have non-prime digits in the middle of the number.</p>

<p>For example, the number <strong>313</strong> is one of the eleven described, but notice that 1 isnâ€™t prime. But since, itâ€™s in the middle of the number, the number will never right-truncate to 1.</p>

<p>Soâ€¦.do we have to add all digits 1-9 to see if we get a right truncatable prime? Fortunately, there are some numbers we can eliminate. A number containing a <strong>4, 6, or 8</strong> canâ€™t be right truncatable, because at some point, our candidate prime will end in that number, demoting it from prime status.</p>

<p>So we finally have our methodology. Until we find 11 primes:</p>

<ul>
  <li>Start with the primes 3, 5, 7.</li>
  <li>Each time, add all numbers except for 0, 4, 6, and 8 to the <strong>left</strong> of each number to make a new list.</li>
  <li>Remove any numbers which arenâ€™t prime from the list. The new list now only has numbers which are left truncatable.</li>
  <li>Test each left truncatable prime to see if itâ€™s right truncatable. If it is, mark it down and move on.</li>
  <li>Repeat steps 2 through 4, each time adding digits to the left until all 11 primes are found.</li>
</ul>

<p>For our prime list, I generate a sufficiently large set of primes that I use to check. Additionally, Iâ€™ve made a generator to give me the number each time itâ€™s been right truncated, so we can test these on the fly.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">rightTrunkNums</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">while</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">//=</span> <span class="mi">10</span>
        <span class="k">yield</span> <span class="n">x</span>


<span class="n">primes</span> <span class="o">=</span> <span class="n">primesieve</span><span class="p">.</span><span class="n">primes</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>
<span class="c1"># Keep adding digits to the right
# of a number which is left to right
# truncatable. We check these primes
# to see if they are left to right
# truncatable. Don't add 4, 6, 8
# because then it won't be truncatable
# the other direction
</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="c1"># Our starting set are the one digit
# primes...
</span><span class="n">primeSet</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
<span class="c1"># The numbers we can add to the left...
</span><span class="n">addingNumbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
<span class="c1"># While we haven't found all of them.
# We can deal with pure numbers, because
# each time, the length of the numbers
# goes up by one.
</span><span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">tenPower</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">while</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="mi">11</span><span class="p">:</span>
    <span class="c1"># Add all of the possible digits to each
</span>    <span class="c1"># number in our list.
</span>    <span class="n">primeSet</span> <span class="o">=</span> <span class="p">[[</span><span class="n">p</span> <span class="o">+</span> <span class="n">digit</span> <span class="o">*</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="n">tenPower</span><span class="p">)</span> <span class="k">for</span> <span class="n">digit</span> <span class="ow">in</span> <span class="n">addingNumbers</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">primeSet</span><span class="p">]</span>
    <span class="c1"># Flatten it.
</span>    <span class="n">primeSet</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">digitSet</span> <span class="ow">in</span> <span class="n">primeSet</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">digitSet</span><span class="p">]</span>
    <span class="c1"># Go through, remove each number that isn't prime.
</span>    <span class="n">primeSet</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">primeSet</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">primes</span><span class="p">]</span>
    <span class="c1"># We are left with left truncatable primes by definition.
</span>    <span class="c1"># Now go through each prime and check if it's right
</span>    <span class="c1"># truncatable
</span>    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">primeSet</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">rightTrunkNums</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">num</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">primes</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="c1"># Check if num is less than 10 and a prime...
</span>        <span class="k">if</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">primes</span><span class="p">:</span>
            <span class="c1"># We found one...
</span>            <span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">p</span>
        <span class="c1"># else:
</span>        <span class="c1">#     primeSet.remove(p)
</span>    <span class="c1"># Increase power of ten...
</span>    <span class="n">tenPower</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="k">print</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</code></pre></div></div>

<p>Running the code mass above results in an output of,</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>23
53
73
37
313
373
317
797
3137
3797
739397

748317
0.4748998125831603 seconds.
</code></pre></div></div>

<p>Therefore, the 11 primes we are looking for are 23, 53, 73, 37, 313, 373, 317, 797, 3137, 3797, and 739397, and consequently, their sum is <strong>748317</strong>.</p>
:ET